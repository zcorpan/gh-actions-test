name: Schedule Label Change Action

on:
  schedule:
    - cron: '*/15 * * * *' # Runs every 15 minutes
  workflow_dispatch: # Allows manual trigger
  
jobs:
  check_and_run:
    runs-on: ubuntu-latest

    steps:
    - name: Set up cache for should_run flag
      id: cache-should-run
      uses: actions/cache@v4
      with:
        path: .github/should_run_flag
        key: should_run_flag

    - name: Check should_run flag
      id: check-should-run
      run: |
        if [ -f ".github/should_run_flag" ] && [ "$(cat .github/should_run_flag)" = "true" ]; then
          echo "should_run=true" >> $GITHUB_ENV
        else
          echo "should_run=false" >> $GITHUB_ENV
        fi

    - name: Run the desired action if should_run is true
      if: env.should_run == 'true'
      run: |
        echo "Labels have changed! Running the desired action."

    - name: Reset should_run flag
      if: env.should_run == 'true'
      run: |
        echo "false" > .github/should_run_flag

    - name: Print should_run flag before check
      run: |
        if [ -f ".github/should_run_flag" ]; then
          cat .github/should_run_flag
        else
          echo "should_run_flag file does not exist."
        fi
        
    - name: Save reset should_run flag to cache
      uses: actions/cache@v4
      with:
        path: .github/should_run_flag
        key: should_run_flag
